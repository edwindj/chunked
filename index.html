<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Data stored in text file can be processed chunkwise using dplyr commands. These
    are recorded and executed per data chunk, so large files can be processed with
    limited memory using the LaF package.">
<title>Chunkwise Text-File Processing for dplyr • chunked</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Chunkwise Text-File Processing for dplyr">
<meta property="og:description" content="Data stored in text file can be processed chunkwise using dplyr commands. These
    are recorded and executed per data chunk, so large files can be processed with
    limited memory using the LaF package.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">chunked</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/edwindj/chunked/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="chunked">chunked<a class="anchor" aria-label="anchor" href="#chunked"></a>
</h1></div>
<p><a href="https://cran.r-project.org/package=chunked" class="external-link"><img src="https://cran.r-project.org/package=chunked" alt="version"></a> <a href="https://cran.r-project.org/package=chunked" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/chunked" alt="Downloads"></a> <a href="https://github.com/edwindj/chunked/actions" class="external-link"><img src="https://github.com/edwindj/chunked/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a> <a href="https://coveralls.io/github/edwindj/chunked?branch=master" class="external-link"><img src="https://coveralls.io/repos/edwindj/chunked/badge.svg?branch=master&amp;service=github" alt="Coverage Status"></a> R is a great tool, but processing data in large text files is cumbersome. <code>chunked</code> helps you to process large text files with <em>dplyr</em> while loading only a part of the data in memory. It builds on the excellent R package <a href="https://github.com/djvanderlaan/LaF" class="external-link"><em>LaF</em></a>.</p>
<p>Processing commands are written in dplyr syntax, and <code>chunked</code> (using <code>LaF</code>) will take care that chunk by chunk is processed, taking far less memory than otherwise. <code>chunked</code> is useful for <strong>select</strong>-ing columns, <strong>mutate</strong>-ing columns and <strong>filter</strong>-ing rows. It is less helpful in <strong>group</strong>-ing and <strong>summarize</strong>-ation of large text files. It can be used in data pre-processing.</p>
<div class="section level2">
<h2 id="install">Install<a class="anchor" aria-label="anchor" href="#install"></a>
</h2>
<p>‘chunked’ can be installed with</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'chunked'</span><span class="op">)</span></code></pre></div>
<p>beta version with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'chunked'</span>, repos<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'https://cran.rstudio.com'</span>, <span class="st">'https://edwindj.github.io/drat'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>and the development version with:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">'edwindj/chunked'</span><span class="op">)</span></code></pre></div>
<p>Enjoy! Feedback is welcome…</p>
</div>
</div>
<div class="section level1">
<h1 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h1>
<div class="section level2">
<h2 id="text-file---process---text-file">Text file -&gt; process -&gt; text file<a class="anchor" aria-label="anchor" href="#text-file---process---text-file"></a>
</h2>
<p>Most common case is processing a large text file, select or add columns, filter it and write the result back to a text file</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="fu"><a href="reference/read_chunkwise.html">read_chunkwise</a></span><span class="op">(</span><span class="st">"./large_file_in.csv"</span>, chunk_size<span class="op">=</span><span class="fl">5000</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/chunked-package.html">select</a></span><span class="op">(</span><span class="va">col1</span>, <span class="va">col2</span>, <span class="va">col5</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="reference/chunked-package.html">filter</a></span><span class="op">(</span><span class="va">col1</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/chunked-package.html">mutate</a></span><span class="op">(</span>col6 <span class="op">=</span> <span class="va">col1</span> <span class="op">+</span> <span class="va">col2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/write_chunkwise.html">write_chunkwise</a></span><span class="op">(</span><span class="st">"./large_file_out.csv"</span><span class="op">)</span></code></pre></div>
<p><code>chunked</code> will write process the above statement in chunks of 5000 records. This is different from for example <code>read.csv</code> which reads all data into memory before processing it.</p>
</div>
<div class="section level2">
<h2 id="text-file---process---database">Text file -&gt; process -&gt; database<a class="anchor" aria-label="anchor" href="#text-file---process---database"></a>
</h2>
<p>Another option is to use <code>chunked</code> as a preprocessing step before adding it to a database</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'test.db'</span>, create<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">db</span> <span class="op">&lt;-</span> <span class="fu">dbplyr</span><span class="fu">::</span><span class="fu"><a href="https://dbplyr.tidyverse.org/reference/src_dbi.html" class="external-link">src_dbi</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span>

<span class="va">tbl</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="reference/read_chunkwise.html">read_chunkwise</a></span><span class="op">(</span><span class="st">"./large_file_in.csv"</span>, chunk_size<span class="op">=</span><span class="fl">5000</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/chunked-package.html">select</a></span><span class="op">(</span><span class="va">col1</span>, <span class="va">col2</span>, <span class="va">col5</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="reference/chunked-package.html">filter</a></span><span class="op">(</span><span class="va">col1</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/chunked-package.html">mutate</a></span><span class="op">(</span>col6 <span class="op">=</span> <span class="va">col1</span> <span class="op">+</span> <span class="va">col2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/write_chunkwise.html">write_chunkwise</a></span><span class="op">(</span><span class="fu">dbplyr</span><span class="fu">::</span><span class="fu"><a href="https://dbplyr.tidyverse.org/reference/src_dbi.html" class="external-link">src_dbi</a></span><span class="op">(</span><span class="va">db</span><span class="op">)</span>, <span class="st">'my_large_table'</span><span class="op">)</span>
  
<span class="co"># tbl now points to the table in sqlite.</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="db---process---text-file">Db -&gt; process -&gt; Text file<a class="anchor" aria-label="anchor" href="#db---process---text-file"></a>
</h2>
<p>Chunked can be used to export chunkwise to a text file. Note however that in that case processing takes place in the database and the chunkwise restrictions only apply to the writing.</p>
</div>
<div class="section level2">
<h2 id="lazy-processing">Lazy processing<a class="anchor" aria-label="anchor" href="#lazy-processing"></a>
</h2>
<p><code>chunked</code> will not start processing until <code>collect</code> or <code>write_chunkwise</code> is called.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_chunks</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="reference/read_chunkwise.html">read_chunkwise</a></span><span class="op">(</span><span class="st">"./large_file_in.csv"</span>, chunk_size<span class="op">=</span><span class="fl">5000</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/chunked-package.html">select</a></span><span class="op">(</span><span class="va">col1</span>, <span class="va">col3</span><span class="op">)</span>
  
<span class="co"># won't start processing until</span>
<span class="fu">collect</span><span class="op">(</span><span class="va">data_chunks</span><span class="op">)</span>
<span class="co"># or</span>
<span class="fu"><a href="reference/write_chunkwise.html">write_chunkwise</a></span><span class="op">(</span><span class="va">data_chunks</span>, <span class="st">"test.csv"</span><span class="op">)</span>
<span class="co"># or</span>
<span class="fu"><a href="reference/write_chunkwise.html">write_chunkwise</a></span><span class="op">(</span><span class="va">data_chunks</span>, <span class="va">db</span>, <span class="st">"test"</span><span class="op">)</span></code></pre></div>
<p>Syntax completion of variables of a chunkwise file in RStudio works like a charm…</p>
</div>
</div>
<div class="section level1">
<h1 id="dplyr-verbs">Dplyr verbs<a class="anchor" aria-label="anchor" href="#dplyr-verbs"></a>
</h1>
<p><code>chunked</code> implements the following dplyr verbs:</p>
<ul>
<li><code>filter</code></li>
<li><code>select</code></li>
<li><code>rename</code></li>
<li><code>mutate</code></li>
<li><code>mutate_each</code></li>
<li><code>transmute</code></li>
<li><code>do</code></li>
<li><code>tbl_vars</code></li>
<li><code>inner_join</code></li>
<li><code>left_join</code></li>
<li><code>semi_join</code></li>
<li><code>anti_join</code></li>
</ul>
<p>Since data is processed in chunks, some dplyr verbs are not implemented:</p>
<ul>
<li><code>arrange</code></li>
<li><code>right_join</code></li>
<li><code>full_join</code></li>
</ul>
<p><code>summarize</code> and <code>group_by</code> are implemented but generate a warning: they operate on each chunk and <strong>not</strong> on the whole data set. However this makes is more easy to process a large file, by repeatedly aggregating the resulting data.</p>
<ul>
<li><code>summarize</code></li>
<li><code>group_by</code></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">iris</span>, <span class="va">tmp</span>, row.names<span class="op">=</span><span class="cn">FALSE</span>, quote<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="va">iris_cw</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_chunkwise.html">read_chunkwise</a></span><span class="op">(</span><span class="va">tmp</span>, chunk_size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="co"># read in chunks of 30 rows for this example</span>

<span class="va">iris_cw</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">Species</span><span class="op">)</span> <span class="op">%&gt;%</span>            <span class="co"># group in each chunk</span>
  <span class="fu">summarise</span><span class="op">(</span> m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Sepal.Width</span><span class="op">)</span> <span class="co"># and summarize in each chunk</span>
           , w <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>
           <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="va">as.data.frame</span> <span class="op">%&gt;%</span>                  <span class="co"># since each Species has 50 records, results will be in multiple chunks</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">Species</span><span class="op">)</span> <span class="op">%&gt;%</span>              <span class="co"># group the results from the chunk</span>
  <span class="fu">summarise</span><span class="op">(</span>m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">w</span><span class="op">)</span><span class="op">)</span> <span class="co"># and summarize it again</span></code></pre></div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=chunked" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/edwindj/chunked/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/edwindj/chunked/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-2" class="external-link">GPL-2</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing chunked</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Edwin de Jonge <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-6580-4718" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Edwin de Jonge.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
